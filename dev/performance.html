<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance tips · CliffordNumbers.jl</title><meta name="title" content="Performance tips · CliffordNumbers.jl"/><meta property="og:title" content="Performance tips · CliffordNumbers.jl"/><meta property="twitter:title" content="Performance tips · CliffordNumbers.jl"/><meta name="description" content="Documentation for CliffordNumbers.jl."/><meta property="og:description" content="Documentation for CliffordNumbers.jl."/><meta property="twitter:description" content="Documentation for CliffordNumbers.jl."/><meta property="og:url" content="https://brainandforce.github.io/CliffordNumbers.jl/performance.html"/><meta property="twitter:url" content="https://brainandforce.github.io/CliffordNumbers.jl/performance.html"/><link rel="canonical" href="https://brainandforce.github.io/CliffordNumbers.jl/performance.html"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">CliffordNumbers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="numeric.html">Clifford number types</a></li><li><a class="tocitem" href="metrics.html">Metric signatures</a></li><li><a class="tocitem" href="indexing.html">Indexing</a></li><li><a class="tocitem" href="operations.html">Operations</a></li><li class="is-active"><a class="tocitem" href="performance.html">Performance tips</a><ul class="internal"><li><a class="tocitem" href="#Use-literal-powers-when-possible"><span>Use literal powers when possible</span></a></li><li><a class="tocitem" href="#Know-which-scalar-types-work-best"><span>Know which scalar types work best</span></a></li><li><a class="tocitem" href="#Avoid-using-CliffordNumber-in-most-circumstances"><span>Avoid using <code>CliffordNumber</code> in most circumstances</span></a></li><li><a class="tocitem" href="#Know-how-your-CPU&#39;s-SIMD-extensions-work"><span>Know how your CPU&#39;s SIMD extensions work</span></a></li></ul></li><li><a class="tocitem" href="extensions.html">Extensions</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="api/clifford.html">CliffordNumbers</a></li><li><a class="tocitem" href="api/indexing.html">Indexing</a></li><li><a class="tocitem" href="api/math.html">Math</a></li><li><a class="tocitem" href="api/metrics.html">Metric signatures</a></li><li><a class="tocitem" href="api/internal.html">Internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="performance.html">Performance tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="performance.html">Performance tips</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/brainandforce/CliffordNumbers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/brainandforce/CliffordNumbers.jl/blob/main/docs/src/performance.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-tips"><a class="docs-heading-anchor" href="#Performance-tips">Performance tips</a><a id="Performance-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-tips" title="Permalink"></a></h1><p>While CliffordNumbers.jl is intended to be a fast library without much special attention needed to obtain good performance, there are some ways to ensure you are maximizing performance that may not be obvious to a first-time user.</p><h2 id="Use-literal-powers-when-possible"><a class="docs-heading-anchor" href="#Use-literal-powers-when-possible">Use literal powers when possible</a><a id="Use-literal-powers-when-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Use-literal-powers-when-possible" title="Permalink"></a></h2><p>When exponentiating an <code>AbstractCliffordNumber</code>, <code>x^2</code> is preferred to <code>x*x</code>. This package overloads <code>Base.literal_pow</code> to provide efficient exponentiation in terms of the smallest type needed to represent the result.</p><p>As an example, <code>KVector{1}</code>, being a 1-blade, necessarily squares to a scalar, so the return type of <code>(x::KVector{1,Q})^2</code> is always <code>KVector{0,Q}</code>. In general, every even power of a 1-blade is a scalar, and every odd power is a 1-blade. By contrast, <code>x*x</code> returns an <code>EvenCliffordNumber{Q}</code>. For small algebras, this distinction may not be significant, but in the 4D case, such as with the spacetime algebra, <code>x*x</code> is 8 times longer than <code>x^2</code> if <code>x</code> is a <code>KVector{1}</code>.</p><p>It is also important to note that variable exponents will usually trigger promotion to either <code>EvenCliffordNumber</code> or <code>CliffordNumber</code>, depending on the grading of the input. The greatest benefit comes from exponents that may be evaluated at compile time.</p><h2 id="Know-which-scalar-types-work-best"><a class="docs-heading-anchor" href="#Know-which-scalar-types-work-best">Know which scalar types work best</a><a id="Know-which-scalar-types-work-best-1"></a><a class="docs-heading-anchor-permalink" href="#Know-which-scalar-types-work-best" title="Permalink"></a></h2><p>In general, <code>AbstractFloat</code> scalars are the best choice for the scalar type, followed by <code>Integer</code>, then <code>Rational</code>, then <code>BigInt</code> or <code>BigFloat</code>.</p><p>!!! note Fixed point numbers     Fixed-point numbers haven&#39;t been tested with this package, but they are likely as performant as     their backing type, which is usually an <code>Integer</code>.</p><h3 id="Scalars-that-are-not-pure-bits"><a class="docs-heading-anchor" href="#Scalars-that-are-not-pure-bits">Scalars that are not pure bits</a><a id="Scalars-that-are-not-pure-bits-1"></a><a class="docs-heading-anchor-permalink" href="#Scalars-that-are-not-pure-bits" title="Permalink"></a></h3><p>The most important examples of scalars that are not bits types are <code>BigInt</code> and <code>BigFloat</code>. While these may be necessary to represent certain coefficients accurately, there is a performance penalty for using them.</p><p>When a bits type is used as the scalar, Julia can represent an <code>AbstractCliffordNumber</code> as an inline array of scalars without having to resort to pointers. This provides two major benefits:</p><ul><li>The type can live on the stack, meaning that no allocations are needed.</li><li>The type can be stored contiguously in an <code>Array</code>.</li></ul><p>For types that are not pure bits, the scalars are stored as pointers to data on the heap, which may or may not be contiguous, and the performance is usually reduced.</p><h3 id="Rational"><a class="docs-heading-anchor" href="#Rational"><code>Rational</code></a><a id="Rational-1"></a><a class="docs-heading-anchor-permalink" href="#Rational" title="Permalink"></a></h3><p>Unlike the machine integer types <code>Int8</code>, <code>Int16</code>, <code>Int32</code>, and <code>Int64</code>, or the floating point types <code>Float16</code>, <code>Float32</code>, and <code>Float64</code>, performing operations with <code>Rational</code> types is significantly slower, since it requires the use of Euclidean division, which is very slow compared to addition and multiplication.</p><p>Specialized kernels for <code>Rational</code> products are provided that minimize the number of division operations needed, but these are still about 100 times slower than performing the same product with floating point scalars. Improving the speed of these multiplications is a goal for this package, but do not expect the speed to ever rival that of floating-point multiplication or division.</p><h2 id="Avoid-using-CliffordNumber-in-most-circumstances"><a class="docs-heading-anchor" href="#Avoid-using-CliffordNumber-in-most-circumstances">Avoid using <code>CliffordNumber</code> in most circumstances</a><a id="Avoid-using-CliffordNumber-in-most-circumstances-1"></a><a class="docs-heading-anchor-permalink" href="#Avoid-using-CliffordNumber-in-most-circumstances" title="Permalink"></a></h2><p>When performing geometric operations, you can almost always restrict yourself to <code>OddCliffordNumber</code> or <code>EvenCliffordNumber</code> as your largest types. Avoid adding objects with odd and even grades, as this will trigger promotion to <code>CliffordNumber</code>.</p><p>If it appears <code>CliffordNumber</code> is needed, you may want to ask whether you are using the correct algebra for your problem. This question is less so about optimization of your code and more so about how you conceptualize your problem: sometimes it makes more sense to use a larger algebra to get a better picture of the geometry, and use <code>EvenCliffordNumber</code> in the larger algebra as your data representation.</p><p>One circumstance where you may wish to use <code>CliffordNumber</code> is when working with idempotents of the algebra, which may be relevant when working with spinors.</p><h2 id="Know-how-your-CPU&#39;s-SIMD-extensions-work"><a class="docs-heading-anchor" href="#Know-how-your-CPU&#39;s-SIMD-extensions-work">Know how your CPU&#39;s SIMD extensions work</a><a id="Know-how-your-CPU&#39;s-SIMD-extensions-work-1"></a><a class="docs-heading-anchor-permalink" href="#Know-how-your-CPU&#39;s-SIMD-extensions-work" title="Permalink"></a></h2><p>At this point, you&#39;ve hit hyperoptimization territory. Notes here are intended more so for developers contributing to this package than for ordinary users, but they are included for the sake of completeness.</p><h3 id="SIMD-width"><a class="docs-heading-anchor" href="#SIMD-width">SIMD width</a><a id="SIMD-width-1"></a><a class="docs-heading-anchor-permalink" href="#SIMD-width" title="Permalink"></a></h3><p>CliffordNumbers.jl is written to take advantage of CPU SIMD extensions. Usually, these consist of fixed-size registers of 128, 256, or 512 bits, depending on the implementation.</p><p>While Julia can generate efficient code for <code>Tuple</code> types with up to 32 elements, it&#39;s especially efficient to use types that fit into one SIMD register. When using an x86 CPU with AVX2, which provides 256-bit registers, <code>EvenCliffordNumber{STA,Float32}</code> is a more performant choice than <code>EvenCliffordNumber{STA,Float64}</code>, since the former consists of 8 32-bit scalars (256 bits total) and the latter is twice the size (512 bits total).</p><h3 id="SIMD-operations"><a class="docs-heading-anchor" href="#SIMD-operations">SIMD operations</a><a id="SIMD-operations-1"></a><a class="docs-heading-anchor-permalink" href="#SIMD-operations" title="Permalink"></a></h3><p>The various products of geometric algebra can be implemented in terms of three common SIMD operations: add, multiply, and permute. Although these operations are usually available for every basic real number type, some implementations have gaps which may prevent SIMD extension from being used.</p><p>One notable pitfall is the lack of SIMD multiply instructions for <code>Int64</code> on x86 with AVX2 only. It is possible to perform a 64-bit multiply using AVX2, but these are not available as single instructions, and Julia&#39;s compiler does not generate SIMD code for these operations. On AVX-512 and AVX10, this instruction is available.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="operations.html">« Operations</a><a class="docs-footer-nextpage" href="extensions.html">Extensions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 4 November 2024 21:24">Monday 4 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
